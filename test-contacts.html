<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cairo', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1A73E8;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 6px;
            border-left: 4px solid #1A73E8;
        }
        
        .test-section h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        button {
            padding: 12px 24px;
            background: #1A73E8;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin-right: 10px;
            font-family: 'Cairo', Arial, sans-serif;
        }
        
        button:hover {
            background: #1557B0;
        }
        
        button.secondary {
            background: #6c757d;
        }
        
        button.secondary:hover {
            background: #5a6268;
        }
        
        .output {
            margin-top: 15px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .output.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .output.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .output.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Cairo', Arial, sans-serif;
            font-size: 14px;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #1A73E8;
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h1>
        
        <!-- 1. API Connection Test -->
        <div class="test-section">
            <h2>1ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ API</h2>
            <p>ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† API ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¹Ù…Ù„Ø§Ù† Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</p>
            <button onclick="testAPIConnection()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
            <div id="apiOutput"></div>
        </div>
        
        <!-- 2. Table Existence Test -->
        <div class="test-section">
            <h2>2ï¸âƒ£ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ø¯ÙˆÙ„ Contacts</h2>
            <p>ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¬Ø¯ÙˆÙ„ contacts Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Supabase</p>
            <button onclick="testTableExistence()">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
            <div id="tableOutput"></div>
        </div>
        
        <!-- 3. Test Insert -->
        <div class="test-section">
            <h2>3ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¯Ø±Ø§Ø¬ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <form id="testForm" onsubmit="testInsertMessage(event)">
                <div class="form-group">
                    <label for="testName">Ø§Ù„Ø§Ø³Ù…:</label>
                    <input type="text" id="testName" value="Ø§Ø®ØªØ¨Ø§Ø±" required>
                </div>
                <div class="form-group">
                    <label for="testEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                    <input type="email" id="testEmail" value="test@example.com" required>
                </div>
                <div class="form-group">
                    <label for="testSubject">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</label>
                    <input type="text" id="testSubject" value="Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±" required>
                </div>
                <div class="form-group">
                    <label for="testMessage">Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                    <textarea id="testMessage" required>Ù‡Ø°Ù‡ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</textarea>
                </div>
                <button type="submit">Ø¥Ø¯Ø±Ø§Ø¬ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±</button>
            </form>
            <div id="insertOutput"></div>
        </div>
        
        <!-- 4. Test Retrieve -->
        <div class="test-section">
            <h2>4ï¸âƒ£ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h2>
            <p>Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
            <button onclick="testRetrieveMessages()">Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</button>
            <button class="secondary" onclick="clearAllMessages()" style="background: #dc3545;">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙ‚Ø·)</button>
            <div id="retrieveOutput"></div>
        </div>
        
        <!-- 5. Browser Console -->
        <div class="test-section">
            <h2>5ï¸âƒ£ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØµÙØ­</h2>
            <button onclick="showConsoleInfo()">Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Console</button>
            <button class="secondary" onclick="openDevTools()">ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± (F12)</button>
            <div id="consoleOutput"></div>
        </div>
    </div>

    <script src="javascript/supabase-client.js"></script>
    <script>
        function log(outputId, message, type = 'info') {
            const output = document.getElementById(outputId);
            output.className = 'output ' + type;
            output.textContent = message;
        }
        
        async function testAPIConnection() {
            log('apiOutput', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...', 'info');
            
            try {
                console.log('Testing API Connection...');
                console.log('API object:', API);
                console.log('API.contacts:', API.contacts);
                
                if (!API || !API.contacts) {
                    throw new Error('API object is not defined or API.contacts is missing');
                }
                
                log('apiOutput', 'âœ… Ù†Ø¬Ø­! API Ù…ÙˆØ¬ÙˆØ¯ ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…\n\nAPI.contacts methods:\n' + Object.keys(API.contacts).join('\n'), 'success');
            } catch (error) {
                log('apiOutput', 'âŒ Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        
        async function testTableExistence() {
            log('tableOutput', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...', 'info');
            
            try {
                const result = await API.contacts.getAll();
                log('tableOutput', 'âœ… Ù†Ø¬Ø­! Ø¬Ø¯ÙˆÙ„ contacts Ù…ÙˆØ¬ÙˆØ¯\n\nØ¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ' + (result ? result.length : 0), 'success');
            } catch (error) {
                log('tableOutput', 'âŒ Ø®Ø·Ø£ - Ø¬Ø¯ÙˆÙ„ contacts Ù‚Ø¯ Ù„Ø§ ÙŠÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹:\n' + error.message, 'error');
            }
        }
        
        async function testInsertMessage(event) {
            event.preventDefault();
            log('insertOutput', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬...', 'info');
            
            try {
                const contactData = {
                    name: document.getElementById('testName').value,
                    email: document.getElementById('testEmail').value,
                    phone: '',
                    subject: document.getElementById('testSubject').value,
                    message: document.getElementById('testMessage').value
                };
                
                console.log('Inserting:', contactData);
                const result = await API.contacts.create(contactData);
                
                log('insertOutput', 'âœ… Ù†Ø¬Ø­! ØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­\n\nÙ…Ø¹Ø±Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ' + (result.id || 'Ø¨Ø¯ÙˆÙ† ID'), 'success');
            } catch (error) {
                log('insertOutput', 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬:\n' + error.message, 'error');
            }
        }
        
        async function testRetrieveMessages() {
            log('retrieveOutput', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹...', 'info');
            
            try {
                const messages = await API.contacts.getAll();
                
                if (!messages || messages.length === 0) {
                    log('retrieveOutput', 'âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\n\nØ¬Ø±Ø¨ Ø¥Ø¯Ø±Ø§Ø¬ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                    return;
                }
                
                let output = `âœ… ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ${messages.length} Ø±Ø³Ø§Ù„Ø©(Ø±Ø³Ø§Ø¦Ù„)\n\n`;
                messages.forEach((msg, index) => {
                    output += `\nØ±Ø³Ø§Ù„Ø© ${index + 1}:\n`;
                    output += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
                    output += `Ø§Ù„Ø§Ø³Ù…: ${msg.name}\n`;
                    output += `Ø§Ù„Ø¨Ø±ÙŠØ¯: ${msg.email}\n`;
                    output += `Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${msg.subject}\n`;
                    output += `Ù…Ù‚Ø±ÙˆØ¡: ${msg.is_read ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}\n`;
                    output += `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(msg.created_at).toLocaleString('ar-EG')}\n`;
                });
                
                log('retrieveOutput', output, 'success');
            } catch (error) {
                log('retrieveOutput', 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹:\n' + error.message, 'error');
            }
        }
        
        async function clearAllMessages() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ Ù‡Ø°Ø§ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
                return;
            }
            
            try {
                const messages = await API.contacts.getAll();
                
                for (const msg of messages) {
                    await API.contacts.delete(msg.id);
                }
                
                log('retrieveOutput', 'âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                log('retrieveOutput', 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù:\n' + error.message, 'error');
            }
        }
        
        function showConsoleInfo() {
            const info = `
Browser Information:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
User Agent: ${navigator.userAgent}
Language: ${navigator.language}
Platform: ${navigator.platform}

API Information:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
API defined: ${typeof API !== 'undefined'}
API.contacts defined: ${typeof API?.contacts !== 'undefined'}
Supabase URL: ${SUPABASE_URL || 'Not defined'}
SUPABASE_ANON_KEY: ${SUPABASE_ANON_KEY ? 'Defined' : 'Not defined'}

LocalStorage:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
sb_token: ${localStorage.getItem('sb_token') ? 'Exists' : 'Not found'}
sb_user: ${localStorage.getItem('sb_user') ? 'Exists' : 'Not found'}

ğŸ‘‰ Ø§ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± (F12) ÙˆØ§Ù†Ø¸Ø± Ø¥Ù„Ù‰ Console Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
            `;
            log('consoleOutput', info, 'info');
        }
        
        function openDevTools() {
            alert('Ø§Ø¶ØºØ· F12 Ø£Ùˆ Ctrl+Shift+I Ù„ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±\nØ«Ù… Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ ØªØ¨ÙˆÙŠØ¨ Console Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©');
        }
        
        // Initial connection test on load
        window.addEventListener('load', () => {
            testAPIConnection();
        });
    </script>
</body>
</html>
